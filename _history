{"entries":[{"timestamp":1752009907885,"editorVersion":"2.0.56","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":1225,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"x#6_p)RZOq[}=u*Hl%Z=\">Player</variable><variable type=\"KIND_SpriteKind\" id=\".ct{(+,EQOw61w:|BB#I\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"T1c9pSfGgvFQ%urC?2uf\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"}^g0-UE:B#b^#xOFRn-k\">Enemy</variable><variable id=\")1.%f7)urSG^O[eNP..u\">mySprite</variable><variable id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</variable><variable id=\"3D%Wp?esD^5N01?*4!tC\">item</variable></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"typescript_statement\" editable=\"false\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let mySoftBody: softbody.SoftBody = null\" numlines=\"1\" declaredvars=\"mySoftBody\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"3D%Wp?esD^5N01?*4!tC\">item</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n"]]},{"start1":1107,"length1":3612,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":\"2:YchS[FTEKFQPYm2V07\"}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"softbody_createSoftBody\"><value name=\"segment\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"3D%Wp?esD^5N01?*4!tC\">item</field></shadow></value><value name=\"length\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value><value name=\"segments\"><shadow type=\"math_number\"><field name=\"NUM\">12</field></shadow></value><value name=\"hasGravity\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value></block></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"3D%Wp?esD^5N01?*4!tC\">item</field></shadow></value><next><block type=\"softbody_setDamping\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"value\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"1\" label=\"Number\" precision=\"0\"></mutation><field name=\"SLIDER\">0.95</field></shadow></value><next><block type=\"softbody_placeSoftBody\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"x\"><shadow type=\"math_number\"><field name=\"NUM\">80</field></shadow></value><value name=\"y\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><next><block type=\"softbody_setLineColor\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"color\"><shadow type=\"math_number\"><field name=\"NUM\">7</field></shadow></value><next><block type=\"softbody_setSegmentGravity\"><value name=\"index\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"hasGravity\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></shadow></value><next><block type=\"function_call\"><mutation name=\"add_player\" functionid=\",,(U}W8W/a3+7+Gnl81Z\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"gameupdate\" x=\"625\" y=\"0\"><statement name=\"HANDLER\"><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n"]]},{"start1":23341,"length1":2990,"diffs":[[1,"`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":\"GL6922`-7|0Z?F4|lnv}\"}}</data></shadow></value><next><block type=\"typescript_statement\" editable=\"false\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"softbody.renderSoftBody(mySoftBody, 1, scene.backgroundImage())\" numlines=\"1\"></mutation><next><block type=\"softbody_updateSoftBody\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1256\" y=\"0\"><mutation name=\"add_player\" functionid=\",,(U}W8W/a3+7+Gnl81Z\"></mutation><field name=\"function_name\">add_player</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">assets.image`player`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":\"myImages.image1\"}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"game_control_sprite\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"sprite\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></shadow></value><next><block type=\"spritesetsetstayinscreen\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"spritesetpos\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></block></value><value name=\"x\"><shadow type=\"positionPicker\"><field name=\"index\">21</field></shadow></value><value name=\"y\"><shadow type=\"positionPicker\"><field name=\"index\">83</field></shadow></value><next><block type=\"softbody_addSegmentToSoftBody\"><value name=\"sprite\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></shadow></value><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block></xml>"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":341,"length1":44,"diffs":[[1,""]]}]},{"type":"added","filename":"test.ts","value":"// tests go here; this will not be compiled when this package is used as an extension.\n"}]}],"snapshots":[{"timestamp":1752009907884,"editorVersion":"2.0.56","text":{"main.blocks":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables><variable type=\"KIND_SpriteKind\" id=\"x#6_p)RZOq[}=u*Hl%Z=\">Player</variable><variable type=\"KIND_SpriteKind\" id=\".ct{(+,EQOw61w:|BB#I\">Projectile</variable><variable type=\"KIND_SpriteKind\" id=\"T1c9pSfGgvFQ%urC?2uf\">Food</variable><variable type=\"KIND_SpriteKind\" id=\"}^g0-UE:B#b^#xOFRn-k\">Enemy</variable><variable id=\")1.%f7)urSG^O[eNP..u\">mySprite</variable><variable id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</variable><variable id=\"3D%Wp?esD^5N01?*4!tC\">item</variable></variables><block type=\"pxt-on-start\" x=\"0\" y=\"0\"><statement name=\"HANDLER\"><block type=\"typescript_statement\" editable=\"false\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"let mySoftBody: softbody.SoftBody = null\" numlines=\"1\" declaredvars=\"mySoftBody\"></mutation><next><block type=\"variables_set\"><field name=\"VAR\" id=\"3D%Wp?esD^5N01?*4!tC\">item</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">img`\n8 8 8 \n8 8 8 \n8 8 8 \n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":\"2:YchS[FTEKFQPYm2V07\"}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"variables_set\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"softbody_createSoftBody\"><value name=\"segment\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"3D%Wp?esD^5N01?*4!tC\">item</field></shadow></value><value name=\"length\"><shadow type=\"math_number\"><field name=\"NUM\">5</field></shadow></value><value name=\"segments\"><shadow type=\"math_number\"><field name=\"NUM\">12</field></shadow></value><value name=\"hasGravity\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></shadow></value></block></value><next><block type=\"spritedestroy2\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><field name=\"effect\">effects.spray</field><value name=\"sprite\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"3D%Wp?esD^5N01?*4!tC\">item</field></shadow></value><next><block type=\"softbody_setDamping\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"value\"><shadow type=\"math_number_minmax\"><mutation min=\"0\" max=\"1\" label=\"Number\" precision=\"0\"></mutation><field name=\"SLIDER\">0.95</field></shadow></value><next><block type=\"softbody_placeSoftBody\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"x\"><shadow type=\"math_number\"><field name=\"NUM\">80</field></shadow></value><value name=\"y\"><shadow type=\"math_number\"><field name=\"NUM\">20</field></shadow></value><next><block type=\"softbody_setLineColor\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"color\"><shadow type=\"math_number\"><field name=\"NUM\">7</field></shadow></value><next><block type=\"softbody_setSegmentGravity\"><value name=\"index\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow></value><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value><value name=\"hasGravity\"><shadow type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></shadow></value><next><block type=\"function_call\"><mutation name=\"add_player\" functionid=\",,(U}W8W/a3+7+Gnl81Z\"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type=\"gameupdate\" x=\"625\" y=\"0\"><statement name=\"HANDLER\"><block type=\"gamesetbackgroundimage\"><value name=\"img\"><shadow type=\"background_image_picker\"><field name=\"img\">img`\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n................................................................................................................................................................\n`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":\"GL6922`-7|0Z?F4|lnv}\"}}</data></shadow></value><next><block type=\"typescript_statement\" editable=\"false\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" line0=\"softbody.renderSoftBody(mySoftBody, 1, scene.backgroundImage())\" numlines=\"1\"></mutation><next><block type=\"softbody_updateSoftBody\"><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value></block></next></block></next></block></statement></block><block type=\"function_definition\" x=\"1256\" y=\"0\"><mutation name=\"add_player\" functionid=\",,(U}W8W/a3+7+Gnl81Z\"></mutation><field name=\"function_name\">add_player</field><statement name=\"STACK\"><block type=\"variables_set\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field><value name=\"VALUE\"><shadow type=\"math_number\"><field name=\"NUM\">0</field></shadow><block type=\"spritescreate\"><value name=\"img\"><shadow type=\"screen_image_picker\"><field name=\"img\">assets.image`player`</field><data>{\"commentRefs\":[],\"fieldData\":{\"img\":\"myImages.image1\"}}</data></shadow></value><value name=\"kind\"><shadow type=\"spritekind\"><field name=\"MEMBER\">Player</field></shadow></value></block></value><next><block type=\"game_control_sprite\"><mutation xmlns=\"http://www.w3.org/1999/xhtml\" _expanded=\"0\" _input_init=\"true\"></mutation><value name=\"sprite\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></shadow></value><next><block type=\"spritesetsetstayinscreen\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></block></value><value name=\"on\"><shadow type=\"toggleOnOff\"><field name=\"on\">true</field></shadow></value><next><block type=\"spritesetpos\"><value name=\"sprite\"><block type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></block></value><value name=\"x\"><shadow type=\"positionPicker\"><field name=\"index\">21</field></shadow></value><value name=\"y\"><shadow type=\"positionPicker\"><field name=\"index\">83</field></shadow></value><next><block type=\"softbody_addSegmentToSoftBody\"><value name=\"sprite\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\")1.%f7)urSG^O[eNP..u\">mySprite</field></shadow></value><value name=\"softBody\"><shadow type=\"variables_get\"><field name=\"VAR\" id=\"Yjr5dZ3x}MDH;Z2]t]9X\">mySoftBody</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block></xml>","main.ts":"","README.md":" ","assets.json":"","soft_body.ts":"//% weight=100 color=#7E58AD icon=\"➰\"\nnamespace softbody {\n    let activeSoftBodies: SoftBody[] = []\n    export class SoftBody {\n        public points: Sprite[] = []\n        public oldX: number[] = []\n        public oldY: number[] = []\n        public segmentLength: number\n        public image: Image | null = null\n        public shouldDraw: boolean\n        public hasGravity: boolean\n        public isFixed: boolean[] = []\n        public gravityStrength: number = 400\n        public connections: {\n            otherBody: SoftBody,\n            thisSegment: number,\n            otherSegment: number,\n            restLength: number\n        }[] = []\n        public lineColor: number = 1\n        public shouldDrawLines: boolean = false\n        public damping: number = 0.98\n        public springStiffness: number = 0.8\n\n        private createSegmentSprite(templateImage: Image, x: number, y: number): Sprite {\n            let newImage = templateImage.clone()\n            let sprite = sprites.create(newImage)\n            sprite.x = x\n            sprite.y = y\n            return sprite\n        }\n\n        constructor(segment: Sprite, length: number, segments: number, hasGravity: boolean) {\n            this.segmentLength = length\n            this.hasGravity = hasGravity\n\n            // Create a fresh template image\n            let templateImage = image.create(segment.image.width, segment.image.height)\n            templateImage.drawImage(segment.image, 0, 0)\n\n            // Create unique sprites for this chain\n            for (let i = 0; i < segments; i++) {\n                let newSprite = sprites.create(templateImage.clone())\n                newSprite.setPosition(segment.x + (i * length), segment.y)\n\n                this.points.push(newSprite)\n                this.oldX.push(newSprite.x)\n                this.oldY.push(newSprite.y)\n                this.isFixed.push(false)\n            }\n        }\n\n\n\n        update() {\n            const dt = 1 / 60\n\n            // Store all force calculations before applying them\n            let forces: { x: number, y: number }[] = []\n            for (let i = 0; i < this.points.length; i++) {\n                forces.push({ x: 0, y: 0 })\n            }\n\n            // Calculate all forces\n            for (let i = 0; i < this.points.length - 1; i++) {\n                let pointA = this.points[i]\n                let pointB = this.points[i + 1]\n\n                let dx = pointB.x - pointA.x\n                let dy = pointB.y - pointA.y\n                let distance = Math.sqrt(dx * dx + dy * dy)\n\n                let diff = this.segmentLength - distance\n                let force = (diff / distance) * this.springStiffness\n\n                let forceX = dx * force\n                let forceY = dy * force\n\n                if (!this.isFixed[i]) {\n                    forces[i].x -= forceX\n                    forces[i].y -= forceY\n                }\n                if (!this.isFixed[i + 1]) {\n                    forces[i + 1].x += forceX\n                    forces[i + 1].y += forceY\n                }\n            }\n\n            // Apply forces with snappier response\n            for (let i = 0; i < this.points.length; i++) {\n                if (!this.isFixed[i]) {\n                    let point = this.points[i]\n                    let tempX = point.x\n                    let tempY = point.y\n\n                    let velX = (point.x - this.oldX[i]) * this.damping\n                    let velY = (point.y - this.oldY[i]) * this.damping\n\n                    point.x += velX + forces[i].x\n                    point.y += velY + forces[i].y\n\n                    if (this.hasGravity) {\n                        point.y += this.gravityStrength * dt * dt\n                    }\n\n                    this.oldX[i] = tempX\n                    this.oldY[i] = tempY\n                }\n            }\n        }\n\n\n\n        // Add this method inside the SoftBody class\n        setSegmentGravity(index: number, hasGravity: boolean) {\n            if (index >= 0 && index < this.points.length) {\n                this.isFixed[index] = !hasGravity\n            }\n        }\n        // Add these methods to the SoftBody class\n        setGravityStrength(strength: number) {\n            this.gravityStrength = strength\n        }\n\n        setSegmentPosition(index: number, x: number, y: number) {\n            if (index >= 0 && index < this.points.length) {\n                this.points[index].x = x\n                this.points[index].y = y\n                this.oldX[index] = x\n                this.oldY[index] = y\n            }\n        }\n\n        static connectSoftBodies(body1: SoftBody, segment1: number, body2: SoftBody, segment2: number) {\n            // Create a joint between the segments\n            let dx = body2.points[segment2].x - body1.points[segment1].x\n            let dy = body2.points[segment2].y - body1.points[segment1].y\n            let distance = Math.sqrt(dx * dx + dy * dy)\n\n            // Store connection info in both bodies\n            body1.connections.push({\n                otherBody: body2,\n                thisSegment: segment1,\n                otherSegment: segment2,\n                restLength: distance\n            })\n            body2.connections.push({\n                otherBody: body1,\n                thisSegment: segment2,\n                otherSegment: segment1,\n                restLength: distance\n            })\n        }\n    }\n\n    function solveConstraint(pointA: Sprite, pointB: Sprite, length: number, isFixedA: boolean, isFixedB: boolean) {\n        let dx = pointB.x - pointA.x\n        let dy = pointB.y - pointA.y\n        let distance = Math.sqrt(dx * dx + dy * dy)\n\n        let diff = length - distance\n        let percent = diff / distance / 2\n        let offsetX = dx * percent\n        let offsetY = dy * percent\n\n        if (!isFixedB) {\n            pointB.x += offsetX\n            pointB.y += offsetY\n        }\n        if (!isFixedA) {\n            pointA.x -= offsetX\n            pointA.y -= offsetY\n        }\n    }\n\n    export enum SegmentDirection {\n        //% block=\"right\"\n        Right,\n        //% block=\"left\"\n        Left,\n        //% block=\"up\"\n        Up,\n        //% block=\"down\"\n        Down\n    }\n\n    //% block=\"create soft body from $segment length $length segments $segments gravity $hasGravity\"\n    //% segment.shadow=variables_get\n    //% length.defl=5\n    //% segments.defl=8\n    //% hasGravity.defl=true\n    //% blockSetVariable=mySoftBody\n    //% group=\"Creation\"\n    export function createSoftBody(segment: Sprite, length: number, segments: number, hasGravity: boolean): SoftBody {\n        let body = new SoftBody(segment, length, segments, hasGravity)\n        activeSoftBodies.push(body)\n        return body\n    }\n\n\n    //% block=\"create soft body from sprite array $segments with length $length gravity $hasGravity\"\n    //% segments.shadow=variables_get\n    //% length.defl=5\n    //% hasGravity.defl=true\n    //% group=\"Creation\"\n    export function createSoftBodyFromArray(segments: Sprite[], length: number, hasGravity: boolean): SoftBody {\n        let body = new SoftBody(segments[0], length, segments.length, hasGravity)\n\n        // Replace the auto-generated sprites with the provided ones\n        for (let i = 0; i < segments.length; i++) {\n            body.points[i].destroy()\n            body.points[i] = segments[i]\n            body.oldX[i] = segments[i].x\n            body.oldY[i] = segments[i].y\n        }\n\n        activeSoftBodies.push(body)\n        return body\n    }\n\n\n\n\n    //% block=\"set segment $index in $softBody gravity $hasGravity\"\n    //% index.defl=0\n    //% softBody.shadow=variables_get\n    //% hasGravity.defl=true\n    //% group=\"Modify\"\n    export function setSegmentGravity(index: number, softBody: SoftBody, hasGravity: boolean) {\n        softBody.setSegmentGravity(index, hasGravity)\n    }\n\n    //% block=\"update $softBody\"\n    //% softBody.shadow=variables_get\n    //% group=\"Update\"\n    export function updateSoftBody(softBody: SoftBody) {\n        softBody.update()\n    }\n\n    // Add these block definitions\n    //% block=\"set $softBody gravity strength to $strength\"\n    //% softBody.shadow=variables_get\n    //% strength.defl=400\n    //% group=\"Modify\"\n    export function setGravityStrength(softBody: SoftBody, strength: number) {\n        softBody.setGravityStrength(strength)\n    }\n\n    //% block=\"set segment $index in $softBody position to x $x y $y\"\n    //% softBody.shadow=variables_get\n    //% index.defl=0\n    //% x.defl=80 y.defl=60\n    //% group=\"Modify\"\n    export function setSegmentPosition(index: number, softBody: SoftBody, x: number, y: number) {\n        softBody.setSegmentPosition(index, x, y)\n    }\n\n    //% block=\"connect segment $segment1 of $body1 to segment $segment2 of $body2\"\n    //% body1.shadow=variables_get\n    //% body2.shadow=variables_get\n    //% segment1.defl=0 segment2.defl=0\n    //% group=\"Modify\"\n    export function connectSoftBodies(body1: SoftBody, segment1: number, body2: SoftBody, segment2: number) {\n        SoftBody.connectSoftBodies(body1, segment1, body2, segment2)\n    }\n    // Add these block definitions\n    //% block=\"get segment $index from $softBody\"\n    //% softBody.shadow=variables_get\n    //% index.defl=0\n    //% group=\"Query\"\n    export function getSegment(index: number, softBody: SoftBody): Sprite {\n        return softBody.points[index]\n    }\n\n    //% block=\"draw lines between segments of $softBody with color $color\"\n    //% softBody.shadow=variables_get\n    //% color.defl=1\n    //% group=\"Modify\"\n    export function setLineColor(softBody: SoftBody, color: number) {\n        softBody.lineColor = color\n        softBody.shouldDrawLines = true\n    }\n\n    //% block=\"render soft body $softBody with thickness $thickness on $drawTarget\"\n    //% softBody.shadow=variables_get\n    //% thickness.defl=1\n    //% drawTarget.shadow=variables_get\n    //% group=\"Update\"\n    export function renderSoftBody(softBody: SoftBody, thickness: number, drawTarget: Image) {\n        if (softBody.shouldDrawLines) {\n            for (let i = 0; i < softBody.points.length - 1; i++) {\n                drawTarget.drawLine(\n                    softBody.points[i].x,\n                    softBody.points[i].y,\n                    softBody.points[i + 1].x,\n                    softBody.points[i + 1].y,\n                    softBody.lineColor\n                )\n            }\n        }\n    }\n\n\n\n\n    //% block=\"set $softBody damping to $value\"\n    //% softBody.shadow=variables_get\n    //% value.defl=0.98 value.min=0 value.max=1\n    //% group=\"Modify\"\n    export function setDamping(softBody: SoftBody, value: number) {\n        softBody.damping = value\n    }\n\n    //% block=\"set $softBody spring stiffness to $value\"\n    //% softBody.shadow=variables_get\n    //% value.defl=0.8 value.min=0 value.max=2\n    //% group=\"Modify\"\n    export function setSpringStiffness(softBody: SoftBody, value: number) {\n        softBody.springStiffness = value\n    }\n\n    //% block=\"destroy $softBody\"\n    //% softBody.shadow=variables_get\n    //% group=\"Creation\"\n    export function destroySoftBody(softBody: SoftBody) {\n        // Destroy all sprites\n        for (let point of softBody.points) {\n            point.destroy()\n        }\n        // Remove from active soft bodies list\n        activeSoftBodies.removeElement(softBody)\n    }\n\n    //% block=\"add $sprite to $softBody\"\n    //% sprite.shadow=variables_get\n    //% softBody.shadow=variables_get\n    //% group=\"Modify\"\n    export function addSegmentToSoftBody(sprite: Sprite, softBody: SoftBody) {\n        let lastPoint = softBody.points[softBody.points.length - 1]\n        sprite.x = lastPoint.x + softBody.segmentLength\n        sprite.y = lastPoint.y\n\n        softBody.points.push(sprite)\n        softBody.oldX.push(sprite.x)\n        softBody.oldY.push(sprite.y)\n        softBody.isFixed.push(false)\n    }\n\n    //% block=\"remove segment $index from $softBody\"\n    //% index.defl=0\n    //% softBody.shadow=variables_get\n    //% group=\"Modify\"\n    export function removeSegmentFromSoftBody(index: number, softBody: SoftBody) {\n        if (index >= 0 && index < softBody.points.length) {\n            softBody.points[index].destroy()\n            softBody.points.removeAt(index)\n            softBody.oldX.removeAt(index)\n            softBody.oldY.removeAt(index)\n            softBody.isFixed.removeAt(index)\n        }\n    }\n    //% block=\"place $softBody at x $x y $y\"\n    //% softBody.shadow=variables_get\n    //% x.defl=80 y.defl=60\n    //% group=\"Modify\"\n    export function placeSoftBody(softBody: SoftBody, x: number, y: number) {\n        let offsetX = x - softBody.points[0].x\n        let offsetY = y - softBody.points[0].y\n\n        for (let i = 0; i < softBody.points.length; i++) {\n            softBody.points[i].x += offsetX\n            softBody.points[i].y += offsetY\n            softBody.oldX[i] += offsetX\n            softBody.oldY[i] += offsetY\n        }\n    }\n    //% block=\"set $softBody movement locked to $locked\"\n    //% softBody.shadow=variables_get\n    //% locked.defl=true\n    //% group=\"Modify\"\n    export function setSoftBodyLocked(softBody: SoftBody, locked: boolean) {\n        for (let i = 0; i < softBody.points.length; i++) {\n            softBody.isFixed[i] = locked\n        }\n    }\n\n\n    //% block=\"get angle of segment $index in $softBody\"\n    //% softBody.shadow=variables_get\n    //% index.defl=0\n    //% group=\"Query\"\n    export function getSegmentAngle(index: number, softBody: SoftBody): number {\n        if (index >= softBody.points.length - 1) return 0\n\n        let current = softBody.points[index]\n        let next = softBody.points[index + 1]\n\n        let dx = next.x - current.x\n        let dy = next.y - current.y\n\n        return Math.atan2(dy, dx) * 57.296 // Convert radians to degrees\n    }\n    //% block=\"get $softBody segment count\"\n    //% softBody.shadow=variables_get\n    //% group=\"Query\"\n    export function getSoftBodySegmentCount(softBody: SoftBody): number {\n        return softBody.points.length\n    }\n    //% block=\"set $softBody segment direction to $direction\"\n    //% softBody.shadow=variables_get\n    //% direction.defl=SegmentDirection.Right\n    //% group=\"Modify\"\n    export function setSegmentDirection(softBody: SoftBody, direction: SegmentDirection) {\n        let lastPoint = softBody.points[0]\n        for (let i = 1; i < softBody.points.length; i++) {\n            let point = softBody.points[i]\n            switch (direction) {\n                case SegmentDirection.Right:\n                    point.x = lastPoint.x + softBody.segmentLength\n                    point.y = lastPoint.y\n                    break\n                case SegmentDirection.Left:\n                    point.x = lastPoint.x - softBody.segmentLength\n                    point.y = lastPoint.y\n                    break\n                case SegmentDirection.Up:\n                    point.x = lastPoint.x\n                    point.y = lastPoint.y - softBody.segmentLength\n                    break\n                case SegmentDirection.Down:\n                    point.x = lastPoint.x\n                    point.y = lastPoint.y + softBody.segmentLength\n                    break\n            }\n            softBody.oldX[i] = point.x\n            softBody.oldY[i] = point.y\n            lastPoint = point\n        }\n    }\n}\n","tilemap.g.jres":"{\n    \"transparency16\": {\n        \"data\": \"hwQQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"tilemapTile\": true\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myTiles\"\n    }\n}","tilemap.g.ts":"","images.g.jres":"{\n    \"image1\": {\n        \"data\": \"hwQQABAAAAAAAAAAsMsMAAAAsAuw3csAAACwvdvd3QwAALBVvdzdywAAsFtVzd3NAAC7tVXF3c0AsFtVW7XdzQCwVdXRW9XNALBVFf9VVc0Au1X1v1RVxQC1VVVFVFXFALVV1URUVbUAC1tFRFRVuwAAsPtMVNULAAAAALC0uwAAAAAAAAsAAA==\",\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"displayName\": \"player\"\n    },\n    \"*\": {\n        \"mimeType\": \"image/x-mkcd-f4\",\n        \"dataEncoding\": \"base64\",\n        \"namespace\": \"myImages\"\n    }\n}","images.g.ts":"","pxt.json":"{\n    \"name\": \"soft body extension:\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"device\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\",\n        \"assets.json\",\n        \"soft_body.ts\",\n        \"tilemap.g.jres\",\n        \"tilemap.g.ts\",\n        \"images.g.jres\",\n        \"images.g.ts\"\n    ],\n    \"targetVersions\": {\n        \"branch\": \"v1.12.58\",\n        \"tag\": \"v1.12.58\",\n        \"commits\": \"https://github.com/microsoft/pxt-arcade/commits/584edd3155f56d4d2465bddaa067b5e48a37c430\",\n        \"target\": \"1.12.58\",\n        \"pxt\": \"8.5.69\"\n    },\n    \"preferredEditor\": \"blocksprj\"\n}\n"}}],"shares":[],"lastSaveTime":1752010430891}